<section class="search-bar">
    <input type="text" id="search" placeholder="Buscar ...">

    <div class="dropdown">
        <button class="dropbtn">Filtro</button>
        <div class="dropdown-content">
            <a href="#"
               th:each="genero : ${generos}"
               th:attr="data-genero=${genero.nombre}"
               th:text="${genero.nombre}"></a>
        </div>
    </div>
</section>

<section class="hero">
    <h2>Bienvenido a LevelUpGames</h2>
    <p>Compra los mejores videojuegos al mejor precio</p>
</section>

<section class="games">
    <th:block th:each="juego : ${juegos}">
        <div class="game-card"
             th:attr="data-name=${juego.nombre.toLowerCase()}"
             th:attrappend=" data-generos=${juego.nombresGeneros}">
             
            <!-- Mostrar la portada del juego (si existe) -->
            <div th:if="${juego.portada != null}">
                <img th:src="@{'/uploads/' + ${juego.portada.ruta}}" th:alt="${juego.nombre}" />
            </div>

            <h3 th:text="${juego.nombre}"></h3>
            <p th:text="${juego.precio.cantidad + ' €'}"></p>

            <div class="categories">
                <span class="category" th:each="genero : ${juego.generos}" th:text="${genero.nombre}"></span>
            </div>
        </div>
    </th:block>
</section>

<script>
  const searchInput = document.getElementById('search');
  const gameCards = document.querySelectorAll('.game-card');
  const generoLinks = document.querySelectorAll('.dropdown-content a');

  // Al escribir en la barra de búsqueda
  searchInput.addEventListener('input', function () {
    filtrarJuegos();
  });

  // Al hacer clic en un género
  generoLinks.forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault();
      const generoSeleccionado = this.dataset.genero;
      filtrarJuegos(generoSeleccionado);
    });
  });

  // Función para filtrar juegos por texto y género
  function filtrarJuegos(generoSeleccionado = null) {
    const filtroTexto = searchInput.value.toLowerCase();

    gameCards.forEach(card => {
      const nombre = card.getAttribute('data-name');
      const generos = card.getAttribute('data-generos').split(',');

      const coincideTexto = nombre.includes(filtroTexto);
      const coincideGenero = !generoSeleccionado || generos.includes(generoSeleccionado);

      card.style.display = (coincideTexto && coincideGenero) ? '' : 'none';
    });
  }
</script>
