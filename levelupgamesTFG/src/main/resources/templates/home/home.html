<section class="search-bar">
  <input type="text" id="search" placeholder="Buscar ...">

  <div class="dropdown">
    <button class="dropbtn">Filtro</button>
    <div class="dropdown-content">
      <a href="#" th:each="genero : ${generos}" th:attr="data-genero=${genero.nombre}" th:text="${genero.nombre}"></a>
    </div>
  </div>
</section>

<section class="games">
  <th:block th:each="juego : ${juegos}">
    <div class="game-card" th:attr="data-name=${juego.nombre.toLowerCase()}"
      th:attrappend=" data-generos=${juego.nombresGeneros}">

      <a th:href="@{/juego/r/{id}(id=${juego.id})}" target="_self" style="text-decoration: none; color: inherit;">
        <!-- Imagen portada -->
        <div th:if="${juego.portada != null}">
          <img th:src="@{'/uploads/' + ${juego.portada.ruta}}" th:alt="${juego.nombre}" />
        </div>

        <!-- Nombre del juego -->
        <h3 th:text="${juego.nombre}"></h3>

        <!-- Precio -->
        <p class="precio"
        th:text="${(juego.precio.cantidad.compareTo(T(java.math.BigDecimal).ZERO) == 0) ? 'Gratis' : juego.precio.cantidad + ' €'}">
        </p>


        <!-- Lista de géneros -->
        <p>
          <span th:each="genero, iterStat : ${juego.generos}">
            <span class="category" th:text="${genero.nombre}"></span>
          </span>
        </p>
      </a>
    </div>
  </th:block>
</section>

<script>
  const searchInput = document.getElementById('search');
  const gameCards = document.querySelectorAll('.game-card');
  const generoLinks = document.querySelectorAll('.dropdown-content a');

  // Filtrar por texto mientras escribes
  searchInput.addEventListener('input', function () {
    filtrarJuegos();
  });

  // Filtrar por género al clicar
  generoLinks.forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault();
      const generoSeleccionado = this.dataset.genero;
      filtrarJuegos(generoSeleccionado);
    });
  });

  function filtrarJuegos(generoSeleccionado = null) {
    const filtroTexto = searchInput.value.toLowerCase();

    gameCards.forEach(card => {
      const nombre = card.getAttribute('data-name');
      const generos = card.getAttribute('data-generos').split(',');

      const coincideTexto = nombre.includes(filtroTexto);
      const coincideGenero = !generoSeleccionado || generos.includes(generoSeleccionado);

      card.style.display = (coincideTexto && coincideGenero) ? '' : 'none';
    });
  }


</script>

<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function () {
    let successMsg = /*[[${success}]]*/ null;
    let cancelMsg = /*[[${cancel}]]*/ null;

    setTimeout(() => {
      if (successMsg) {
        alert(successMsg);
        removeQueryParam('success');
      } else if (cancelMsg) {
        alert(cancelMsg);
        removeQueryParam('cancel');
      }
    }, 500);

    function removeQueryParam(param) {
      const url = new URL(window.location);
      url.searchParams.delete(param);
      window.history.replaceState({}, document.title, url.toString());
    }
  });
</script>

<script th:if="${alertaRechazo}" type="text/javascript">
  window.addEventListener('DOMContentLoaded', (event) => {
    alert("Tu solicitud como desarrollador ha sido rechazada.");
  });
</script>