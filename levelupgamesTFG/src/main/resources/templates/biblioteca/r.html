<div class="biblioteca-contenedor">
  <!-- Lista de juegos -->
  <aside class="lista-juegos">
    <ul>
      <li th:each="juego : ${juegos}" class="juego-item"
          th:onclick="'mostrarDetalles(' + ${juego.id} + ')'">
        <img class="juego-miniatura"
             th:src="${juego.portada != null} ? @{/uploads/} + ${juego.portada.ruta} : @{/img/default-portada.png}" />
        <span class="juego-nombre" th:text="${juego.nombre}"></span>

        <!-- Datos ocultos para JS -->
        <div class="juego-detalles"
             th:id="'detalle-' + ${juego.id}" style="display:none;"
             th:data-nombre="${juego.nombre}"
             th:data-descripcion="${juego.descripcion}"
             th:data-precio="${juego.precioActual != null ? (juego.precioActual.cantidad == 0 ? 'Gratis' : juego.precioActual.cantidad + ' €') : 'Sin precio'}"
             th:data-imagenes="${#strings.listJoin(juego.imagenes.?[ruta != null].![('/uploads/' + ruta)], ',')}">
        </div>
      </li>
    </ul>
  </aside>

  <!-- Panel de detalles -->
  <section class="detalle-juego" id="detalle-juego">
    <div class="mensaje-inicial" id="mensaje-inicial" th:if="${juegos.size() == 0}">
      <p>Cuando compres un juego, aparecerá en la lista de la izquierda.</p>
    </div>
    <div class="mensaje-inicial" id="mensaje-inicial" th:if="${juegos.size() > 0}">
      <p>Selecciona un juego para ver los detalles.</p>
    </div>
    <div class="contenido-detalle" id="contenido-detalle" style="display:none;">
      <!-- Aquí se cargan los detalles con JS -->
    </div>
  </section>
</div>

<script>
function mostrarDetalles(id) {
  const detalle = document.getElementById(`detalle-${id}`);

  const nombre = detalle.getAttribute('data-nombre');
  const descripcion = detalle.getAttribute('data-descripcion');
  const precio = detalle.getAttribute('data-precio');
  const imagenesData = detalle.getAttribute('data-imagenes');
  const imagenes = imagenesData ? imagenesData.split(',') : [];

  const mensaje = document.getElementById('mensaje-inicial');
  const contenido = document.getElementById('contenido-detalle');

  let imagenesHtml = '<div class="imagenes-juego">';
  imagenes.forEach(src => {
    const trimmedSrc = src.trim();
    if(trimmedSrc) {
      imagenesHtml += `<img src="${trimmedSrc}" alt="Imagen del juego" />`;
    }
  });
  imagenesHtml += '</div>';

  contenido.innerHTML = `
    <h2>${nombre}</h2>
    <p><strong>Precio:</strong> ${precio}</p>
    <p><strong>Descripción:</strong><br>${descripcion}</p>
    ${imagenesHtml}
  `;

  mensaje.style.display = 'none';
  contenido.style.display = 'block';
}
</script>
