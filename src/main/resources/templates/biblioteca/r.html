<div class="biblioteca-contenedor">
  <aside class="lista-juegos">
    <ul>
      <li th:each="compraDTO : ${compras}" class="juego-item"
          th:onclick="'mostrarDetalles(' + ${compraDTO.compra.juego.id} + ')'">
        <img class="juego-miniatura"
             th:src="${compraDTO.compra.juego.portada.ruta != null} ? ${compraDTO.compra.juego.portada.ruta} : @{/img/default-portada.png}" />

        <span class="juego-nombre" th:text="${compraDTO.compra.juego.nombre}"></span>

        <!-- Datos ocultos para JS -->
        <div class="juego-detalles"
             th:id="'detalle-' + ${compraDTO.compra.juego.id}" style="display:none;"
             th:data-nombre="${compraDTO.compra.juego.nombre}"
             th:data-descripcion="${compraDTO.compra.juego.descripcion}"
             th:data-precio="${compraDTO.precioFormateado}"
             th:data-imagenes="${#strings.listJoin(compraDTO.compra.juego.imagenes.?[ruta != null].![(ruta)], ',')}"
             th:data-descargable="${compraDTO.compra.juego.descargable}"
             th:data-fecha-compra="${compraDTO.fechaCompraFormateada}">
        </div>
      </li>
    </ul>
  </aside>

  <section class="detalle-juego" id="detalle-juego">
    <div class="mensaje-inicial" id="mensaje-inicial" th:if="${#lists.isEmpty(compras)}">
      <p>Cuando compres un juego, aparecerá en la lista de la izquierda.</p>
    </div>
    <div class="mensaje-inicial" id="mensaje-inicial" th:if="${!#lists.isEmpty(compras)}">
      <p>Selecciona un juego para ver los detalles.</p>
    </div>
    <div class="contenido-detalle" id="contenido-detalle" style="display:none;"></div>
  </section>
</div>

<script>
  function mostrarDetalles(id) {
    const detalle = document.getElementById(`detalle-${id}`);

  const nombre = detalle.getAttribute('data-nombre');
  const descripcion = detalle.getAttribute('data-descripcion');
  const precio = detalle.getAttribute('data-precio');
  const descargable = detalle.getAttribute('data-descargable');
  const fechaCompra = detalle.getAttribute('data-fecha-compra');
  const imagenesData = detalle.getAttribute('data-imagenes');
  const imagenes = imagenesData ? imagenesData.split(',') : [];

    const mensaje = document.getElementById('mensaje-inicial');
    const contenido = document.getElementById('contenido-detalle');

  let imagenesHtml = '<div class="imagenes-juego">';
  imagenes.forEach(src => {
    const trimmedSrc = src.trim();
    if (trimmedSrc) {
      imagenesHtml += `<img src="${trimmedSrc}" alt="Imagen del juego" />`;
    }
  });
  imagenesHtml += '</div>';

    let descargaHtml = '';
    if (descargable) {
      descargaHtml = `
      <div class="descarga-juego">
        <h3>Descargar juego</h3>
        <a class="boton-descargar" href="/download/${id}">
          Descargar
        </a>
      </div>
    `;
    }

    contenido.innerHTML = `
    <h2>${nombre}</h2>
    <p><strong>Precio:</strong> ${precio}</p>
    <p><strong>Fecha de adquisición:</strong> ${fechaCompra}</p>
    <p><strong>Descripción:</strong><br>${descripcion}</p>
    ${imagenesHtml}
    ${descargaHtml}
  `;

    mensaje.style.display = 'none';
    contenido.style.display = 'block';
  }
</script>