<section class="search-bar">
  <input type="text" id="search" placeholder="Buscar ...">
</section>

<!-- Lista horizontal de géneros -->
<div class="filtro-generos-horizontal">
  <a href="#" data-genero="" class="genero-link active">Todos</a>
  <a href="#" th:each="genero : ${generos}" 
     th:attr="data-genero=${genero.nombre}" 
     th:text="${genero.nombre}" 
     class="genero-link"></a>
</div>

<section class="games">
  <th:block th:each="juego : ${juegos}">
    <div class="game-card" 
         th:attr="data-name=${juego.nombre.toLowerCase()}"
         th:attrappend=" data-generos=${juego.nombresGeneros}">
      <a th:href="@{/juego/r/{id}(id=${juego.id})}" target="_self" style="text-decoration: none; color: inherit;">
        <!-- Imagen portada -->
        <div th:if="${juego.portada != null}">
          <img th:src="@{'/uploads/' + ${juego.portada.ruta}}" th:alt="${juego.nombre}" />
        </div>
        <!-- Nombre del juego -->
        <h3 th:text="${juego.nombre}"></h3>
        <!-- Precio adaptado -->
        <p class="precio" 
           th:text="${juego.precioActual != null 
                     ? (juego.precioActual.cantidad.compareTo(T(java.math.BigDecimal).ZERO) == 0 
                        ? 'Gratis' 
                        : juego.precioActual.cantidad + ' €') 
                     : 'Sin precio'}">
        </p>
        <!-- Lista de géneros -->
        <p>
          <span th:each="genero : ${juego.generos}">
            <span class="category" th:text="${genero.nombre}"></span>
          </span>
        </p>
      </a>
    </div>
  </th:block>
</section>

<!-- Resto del JS sin cambios -->
<script>
  const searchInput = document.getElementById('search');
  const gameCards = document.querySelectorAll('.game-card');
  const generoLinks = document.querySelectorAll('.genero-link');

  let generoSeleccionado = null;

  // Filtrar mientras escribes
  searchInput.addEventListener('input', filtrarJuegos);

  generoLinks.forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault();

      generoSeleccionado = this.dataset.genero || null;

      // Visual: marca el activo
      generoLinks.forEach(l => l.classList.remove('active'));
      this.classList.add('active');

      filtrarJuegos();
    });
  });

  function filtrarJuegos() {
    const filtroTexto = searchInput.value.toLowerCase();

    gameCards.forEach(card => {
      const nombre = card.getAttribute('data-name').toLowerCase();
      const generosAttr = card.getAttribute('data-generos');
      const generos = generosAttr ? generosAttr.split(',').map(g => g.trim()) : [];

      const coincideTexto = nombre.includes(filtroTexto);
      const coincideGenero = !generoSeleccionado || generoSeleccionado === "" || generos.includes(generoSeleccionado);

      card.style.display = (coincideTexto && coincideGenero) ? '' : 'none';
    });
  }
</script>

<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function () {
    let successMsg = /*[[${success}]]*/ null;
    let cancelMsg = /*[[${cancel}]]*/ null;

    setTimeout(() => {
      if (successMsg) {
        alert(successMsg);
        removeQueryParam('success');
      } else if (cancelMsg) {
        alert(cancelMsg);
        removeQueryParam('cancel');
      }
    }, 500);

    function removeQueryParam(param) {
      const url = new URL(window.location);
      url.searchParams.delete(param);
      window.history.replaceState({}, document.title, url.toString());
    }
  });
</script>

<script th:if="${alertaRechazo}" type="text/javascript">
  window.addEventListener('DOMContentLoaded', () => {
    alert("Tu solicitud como desarrollador ha sido rechazada.");
  });
</script>
