<button class="toggle-menu-btn">☰ Menú</button>

<ul class="menu-lateral-separado">
  <li><a href="/perfil/r">Configuración</a></li>
  <li><a href="/perfil/verHistorialCompras">Historial de compras</a></li>
  <li><a href="/perfil/seguridad">Seguridad</a></li>
</ul>

<div class="container">
  <h1>Configuración de Usuario</h1>
  <form method="POST" action="/perfil/actualizarDatosPersonales" id="configForm">
    <label for="loginemail">Email:</label>
    <input type="email" id="loginemail" name="loginemail" disabled th:placeholder="${usuario.loginemail}">

    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre" required minlength="3" th:value="${usuario.nombre}">

    <label for="apellido">Apellido:</label>
    <input type="text" id="apellido" name="apellido" required minlength="3" th:value="${usuario.apellido}">

    <div id="errorMensaje" style="color: red; display: none;"></div>

    <button type="submit" id="guardarBtn" disabled>Guardar cambios</button>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const nombreInput = document.getElementById('nombre');
    const apellidoInput = document.getElementById('apellido');
    const guardarBtn = document.getElementById('guardarBtn');
    const configForm = document.getElementById('configForm');
    const errorMensaje = document.getElementById('errorMensaje');

    const nombreInicial = nombreInput.value.trim();
    const apellidoInicial = apellidoInput.value.trim();

    function validarCambios() {
      const nombreActual = nombreInput.value.trim();
      const apellidoActual = apellidoInput.value.trim();

      const nombreValido = nombreActual.length >= 3;
      const apellidoValido = apellidoActual.length >= 3;
      const sonDistintos = nombreActual !== nombreInicial || apellidoActual !== apellidoInicial;

      if (!nombreValido || !apellidoValido) {
        errorMensaje.style.display = 'block';
        errorMensaje.textContent = 'El nombre y apellido deben tener al menos 3 letras.';
        guardarBtn.disabled = true;
      } else if (!sonDistintos) {
        errorMensaje.style.display = 'block';
        errorMensaje.textContent = 'Debes modificar el nombre o apellido para guardar.';
        guardarBtn.disabled = true;
      } else {
        errorMensaje.style.display = 'none';
        guardarBtn.disabled = false;
      }
    }

    nombreInput.addEventListener('input', validarCambios);
    apellidoInput.addEventListener('input', validarCambios);

    configForm.addEventListener('submit', (e) => {
      if (guardarBtn.disabled) {
        e.preventDefault();
      }
    });

    validarCambios();
  });
</script>
