<div class="container">
  <h1>Editar juego</h1>

  <form th:action="@{/juego/u}" method="post" enctype="multipart/form-data" onsubmit="return validarFormulario()"
    class="form-grid">
    <input type="hidden" name="id" th:value="${juego.id}" />

    <!-- Nombre -->
    <div class="form-group">
      <label for="idNombre">Nombre</label>
      <input id="idNombre" type="text" name="nombre" th:value="${juego.nombre}" required autofocus />
    </div>

    <!-- Precio -->
    <div class="form-group">
      <label for="precio">Precio (€)</label>
      <input type="number" step="0.01" min="0" id="precio" name="precio"
        th:value="${juego.precioActual != null ? juego.precioActual.cantidad : 0}" placeholder="Introduce el precio"
        required />
    </div>

    <!-- Descripción -->
    <div class="form-group full-width">
      <label for="idDesc">Descripción</label>
      <textarea id="idDesc" name="descripcion" rows="4" required th:text="${juego.descripcion}"></textarea>
    </div>

    <!-- Géneros -->
    <div class="form-group full-width">
      <label>Géneros:</label>
      <div class="checkbox-inline-group" id="generos-container">
        <span th:each="genero : ${generos}">
          <label>
            <input type="checkbox" name="generosIds" th:value="${genero.id}"
              th:checked="${juego.generos.contains(genero)}" />
            <span th:text="${genero.nombre}"></span>
          </label>
        </span>
      </div>
      <div id="error-generos" style="color:red; display:none;">Selecciona al menos un género.</div>
    </div>

    <input type="hidden" name="portadaIndex" id="portadaIndex" value="" />

    <!-- Imágenes actuales + portada -->
    <div class="form-group full-width">
      <label>Imágenes del juego:</label>
      <div id="imagenesActualesPreview" class="preview-container">

        <!-- Portada actual -->
        <div th:if="${juego.portada != null}" class="preview-img-wrapper portada-seleccionada"
          title="Haz clic para establecer como portada" onclick="seleccionarPortada(this)">
          <img th:src="@{${juego.portada.ruta}}" class="preview-img" />
          <input type="hidden" name="imagenesExistentes" th:value="${juego.portada.id}" />
          <button type="button" class="delete-btn"
            onclick="event.stopPropagation(); eliminarImagenActual(this);">&times;</button>
        </div>

        <!-- Otras imágenes del juego -->
        <div th:each="imagen : ${juego.imagenes}" th:if="${!imagen.portada}" class="preview-img-wrapper"
          title="Haz clic para establecer como portada" onclick="seleccionarPortada(this)">
          <img th:src="@{${imagen.ruta}}" class="preview-img" />
          <input type="hidden" name="imagenesExistentes" th:value="${imagen.id}" />
          <button type="button" class="delete-btn"
            onclick="event.stopPropagation(); eliminarImagenActual(this);">&times;</button>
        </div>

      </div>
    </div>

    <!-- Añadir nuevas imágenes -->
    <div class="form-group full-width">
      <label for="imagenes">Añadir nuevas imágenes:</label>
      <input id="imagenes" type="file" name="imagenes" multiple accept="image/*" />
      <div id="imagenesPreview"></div>
      <small id="mensaje-portada" style="color: #ffcc00; display: none;">
        Haz clic en una imagen para seleccionarla como portada.
      </small>
    </div>

    <!-- Archivo descargable -->
    <div class="form-group full-width">
      <label>Archivo descargable actual:</label>
      <a th:href="@{'/download/' + ${juego.id}}" target="_blank" th:text="${juego.nombreDescargableOriginal}">Descargar
        archivo actual</a>
    </div>
    <div class="form-group full-width">
      <label for="descargable">Nuevo archivo descargable (opcional):</label>
      <input type="file" id="descargable" name="descargable" accept=".zip,.rar,.exe,.iso,.setup" />
    </div>

    <!-- Botón -->
    <div class="form-group full-width">
      <input type="submit" value="Guardar cambios" />
    </div>
  </form>
</div>

<script src="/js/juego/u.js"></script>